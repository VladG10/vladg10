<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>C√°psulas</title>

<style>
  :root{
    --ruby:#7a0016;
    --panel: rgba(0,0,0,.35);
    --text: rgba(255,255,255,.92);
    --muted: rgba(255,255,255,.65);
    --line: rgba(255,255,255,.12);
  }

  body{
    margin:0;
    min-height:100vh;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background: var(--ruby);
    color: var(--text);
    display:flex;
    justify-content:center;
  }

  .wrap{
    width:min(760px, 92vw);
    padding: 32px 0 80px;
  }

  .intro{
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: 14px;
    padding: 22px 18px;
    margin-bottom: 18px;
    text-align:left;
  }
  .intro h1{
    margin:0 0 8px;
    font-size: 18px;
    letter-spacing:.2px;
  }
  .intro p{
    margin:0;
    color: var(--muted);
    line-height:1.5;
  }

  .card{
    background: var(--panel);
    border: 1px solid var(--line);
    border-radius: 16px;
    padding: 26px 18px;
    margin: 14px 0;
    text-align:center;
    backdrop-filter: blur(2px);
  }

  .num{
    font-size: 44px;
    letter-spacing: 2px;
    font-weight: 800;
    color: rgba(255,255,255,.22);
    margin-bottom: 8px;
    user-select:none;
  }

  .text{
    font-size: 20px;
    line-height: 1.45;
    padding: 0 6px;
  }

  .gate{
    border-radius: 14px;
    padding: 18px 16px;
    margin: 12px 0 18px;
    border: 1px dashed rgba(255,255,255,.25);
    color: rgba(255,255,255,.78);
    text-align:left;
  }
  .gate b{ color: rgba(255,255,255,.95); }

  .meta{
    margin-top: 10px;
    font-size: 13px;
    color: rgba(255,255,255,.55);
  }

  .audio{
    margin-top: 14px;
    display:flex;
    flex-direction:column;
    gap:10px;
    align-items:center;
  }

  .btn{
    border: 1px solid rgba(255,255,255,.35);
    background: rgba(255,255,255,.92);
    color: #3a0010;
    padding: 10px 14px;
    border-radius: 12px;
    font-weight: 700;
    cursor:pointer;
  }
  .btn:active{ transform: translateY(1px); }

  .small{
    font-size: 13px;
    color: rgba(255,255,255,.65);
  }
</style>
</head>

<body>
  <div class="wrap">

    <div class="intro">
      <h1>Hoy no quiero que leas todo de golpe.</h1>
      <p>Quiero que lo vivas conmigo. Regresa cuando el candado te lo pida.</p>
      <div class="meta" id="tzMeta"></div>
    </div>

    <!-- Contenedor donde JS va a pintar capas + gates -->
    <div id="timeline"></div>

  </div>

<script>
  // =========================
  // CONFIG
  // =========================
  // Arranca 09:14 y luego cada hora, 14 capas total
  const START_HOUR = 19;
  const START_MIN  = 45;
  const TOTAL = 14;

  // Textos (ed√≠talos)
  const CAPAS = [
    "Cuando pienso en ti, mi d√≠a se vuelve sol.",
    "Aqu√≠ va tu frase para la Capa 02.",
    "Aqu√≠ va tu frase para la Capa 03.",
    "Aqu√≠ va tu frase para la Capa 04.",
    "Aqu√≠ va tu frase para la Capa 05.",
    "Aqu√≠ va tu frase para la Capa 06.",
    "Aqu√≠ va tu frase para la Capa 07.",
    "Aqu√≠ va tu frase para la Capa 08.",
    "Aqu√≠ va tu frase para la Capa 09.",
    "Aqu√≠ va tu frase para la Capa 10.",
    "Aqu√≠ va tu frase para la Capa 11.",
    "Aqu√≠ va tu frase para la Capa 12.",
    "Aqu√≠ va tu frase para la Capa 13.",
    "Llegamos al final‚Ä¶ gracias por estar aqu√≠."
  ];

  // Si quieres que el audio solo aparezca en capa 14:
  const AUDIO_FILE = "mensaje-final.mp3"; // s√∫belo al repo con ese nombre
  const AUDIO_LABEL = "‚ñ∂ Escuchar mensaje final";

  // =========================
  // HELPERS
  // =========================
  const pad2 = n => String(n).padStart(2,"0");

  function buildUnlockTimes(baseDate){
    // baseDate es "hoy" en el navegador del usuario
    const times = [];
    for(let i=0;i<TOTAL;i++){
      const d = new Date(baseDate);
      d.setHours(START_HOUR + i, START_MIN, 0, 0);
      times.push(d);
    }
    return times;
  }

  function formatTime(d){
    return `${pad2(d.getHours())}:${pad2(d.getMinutes())}`;
  }

  function now(){
    return new Date();
  }

  // =========================
  // RENDER
  // =========================
  function render(){
    const t = document.getElementById("timeline");
    t.innerHTML = "";

    const current = now();
    const unlockTimes = buildUnlockTimes(current);

    // Encuentra cu√°ntas capas ya est√°n desbloqueadas
    let unlockedCount = 0;
    for(let i=0;i<unlockTimes.length;i++){
      if(current >= unlockTimes[i]) unlockedCount = i+1;
    }

    // Si ninguna desbloqueada todav√≠a: solo gate hacia la primera
    if(unlockedCount === 0){
      const g = document.createElement("div");
      g.className = "gate";
      g.innerHTML = `üîí <b>La primera capa se desbloquea a las ${formatTime(unlockTimes[0])}.</b><br>
      No hagas scroll mental todav√≠a üòå`;
      t.appendChild(g);
      return;
    }

    // Pinta capas desbloqueadas + gate hacia la siguiente (si a√∫n falta)
    for(let i=0;i<unlockedCount;i++){
      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="num">${pad2(i+1)}</div>
        <div class="text">${CAPAS[i] ?? ""}</div>
      `;
      t.appendChild(card);

      const nextIndex = i+1;

      // Si esta NO es la √∫ltima capa desbloqueada, no pongas gate (ya est√° la siguiente visible)
      // Si esta ES la √∫ltima desbloqueada y a√∫n quedan capas, pon gate hacia la pr√≥xima hora
      if(i === unlockedCount - 1 && nextIndex < TOTAL){
        const g = document.createElement("div");
        g.className = "gate";
        g.innerHTML = `üîí <b>La siguiente capa se desbloquea a las ${formatTime(unlockTimes[nextIndex])}.</b><br>
        Regresa en ese momento (o qu√©date aqu√≠, se actualiza sola).`;
        t.appendChild(g);
      }
    }

    // Si ya lleg√≥ a la 14, agrega audio bonito al final
    if(unlockedCount >= TOTAL){
      const audioBox = document.createElement("div");
      audioBox.className = "card";
      audioBox.innerHTML = `
        <div class="audio">
          <button class="btn" id="playBtn">${AUDIO_LABEL}</button>
          <div class="small">Tip: si no suena, revisa que el archivo exista y se llame exactamente <b>${AUDIO_FILE}</b>.</div>
          <audio id="finalAudio" preload="auto">
            <source src="${AUDIO_FILE}" type="audio/mpeg">
          </audio>
        </div>
      `;
      t.appendChild(audioBox);

      // hook del bot√≥n
      setTimeout(() => {
        const btn = document.getElementById("playBtn");
        const aud = document.getElementById("finalAudio");
        if(btn && aud){
          btn.onclick = async () => {
            try { await aud.play(); }
            catch(e){ alert("Tu navegador bloque√≥ el audio. Intenta de nuevo tocando el bot√≥n."); }
          };
        }
      }, 0);
    }
  }

  // Meta de zona horaria (para evitar confusiones con distancia)
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone;
  document.getElementById("tzMeta").textContent = `Horario seg√∫n el reloj de este dispositivo (${tz}).`;

  // Render inicial y refresco autom√°tico (din√°mico sin refresh)
  render();
  setInterval(render, 10_000); // cada 10 segundos

</script>
</body>
</html>

